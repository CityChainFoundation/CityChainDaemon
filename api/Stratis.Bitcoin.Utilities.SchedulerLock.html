<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Class SchedulerLock
   | City Chain: Developer Reference </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Class SchedulerLock
   | City Chain: Developer Reference ">
    <meta name="generator" content="docfx 2.56.6.0">
    
    <link rel="shortcut icon" href="../images/favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/icon.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="Stratis.Bitcoin.Utilities.SchedulerLock">
  
  
  <h1 id="Stratis_Bitcoin_Utilities_SchedulerLock" data-uid="Stratis.Bitcoin.Utilities.SchedulerLock" class="text-break">Class SchedulerLock
  </h1>
  <div class="markdown level0 summary"><p>An async reader writer lock for concurrent and exclusive work.</p>
<p>
The class uses ConcurrentExclusiveSchedulerPair to access two task schedulers - concurrent
scheduler and exclusive scheduler. The exclusive scheduler guarantees only one task to be run
at the same, which is what is used as a writer lock. The concurrent scheduler allows multiple
tasks to run simultaneously, but the exclusivity of exclusive scheduler is respected, so it is
used as a reader lock.
</p>
</div>
  <div class="markdown level0 conceptual"></div>
  <div class="inheritance">
    <h5>Inheritance</h5>
    <div class="level0"><span class="xref">System.Object</span></div>
    <div class="level1"><span class="xref">SchedulerLock</span></div>
      <div class="level2"><a class="xref" href="Stratis.Bitcoin.Features.MemoryPool.MempoolSchedulerLock.html">MempoolSchedulerLock</a></div>
  </div>
  <div classs="implements">
    <h5>Implements</h5>
    <div><a class="xref" href="Stratis.Bitcoin.Utilities.ISchedulerLock.html">ISchedulerLock</a></div>
  </div>
  <h6><strong>Namespace</strong>: <a class="xref" href="Stratis.Bitcoin.Utilities.html">Stratis.Bitcoin.Utilities</a></h6>
  <h6><strong>Assembly</strong>: Stratis.Bitcoin.dll</h6>
  <h5 id="Stratis_Bitcoin_Utilities_SchedulerLock_syntax">Syntax</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public class SchedulerLock : object, ISchedulerLock</code></pre>
  </div>
  <h5 id="Stratis_Bitcoin_Utilities_SchedulerLock_remarks"><strong>Remarks</strong></h5>
  <div class="markdown level0 remarks"><p>From the TaskFactory.StartNew() remarks:
Calling StartNew is functionally equivalent to creating a Task using one of its constructors
and then calling <see cref="!:Task.Start()">Start</see> to schedule it for execution. However,
unless creation and scheduling must be separated, StartNew is the recommended approach for both
simplicity and performance.</p>
<p>
WARNING: One has to be very careful using this class as the exclusivity of the exclusive scheduler
only guarantees to actually run one task at the time, but if the task awaits, it is not considered
as running and another task can be scheduled and run instead within the context of the exclusive
scheduler. This means that the tasks run within both exclusive and concurrent schedulers
must not await, otherwise there is a risk of a race condition. Thus in order to use this locking
mechanism, one needs to first break up the asynchronous code to synchronous pieces and only then
schedule the synchronous parts.
</p>
</div>
  <h3 id="constructors">Constructors
  </h3>
  <span class="small pull-right mobile-hide">
    <span class="divider">|</span>
    <a href="https://github.com/CityChainFoundation/city-chain/new/master/docs-ref-overwrite/new?filename=Stratis_Bitcoin_Utilities_SchedulerLock__ctor_CancellationTokenSource_System_Int32_.md&amp;value=---%0Auid%3A%20Stratis.Bitcoin.Utilities.SchedulerLock.%23ctor(CancellationTokenSource%2CSystem.Int32)%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">Improve this Doc</a>
  </span>
  <span class="small pull-right mobile-hide">
    <a href="https://github.com/CityChainFoundation/city-chain/blob/master/src/Stratis.Bitcoin/Utilities/SchedulerLock.cs/#L88">View Source</a>
  </span>
  <a id="Stratis_Bitcoin_Utilities_SchedulerLock__ctor_" data-uid="Stratis.Bitcoin.Utilities.SchedulerLock.#ctor*"></a>
  <h4 id="Stratis_Bitcoin_Utilities_SchedulerLock__ctor_CancellationTokenSource_System_Int32_" data-uid="Stratis.Bitcoin.Utilities.SchedulerLock.#ctor(CancellationTokenSource,System.Int32)">SchedulerLock(CancellationTokenSource, Int32)</h4>
  <div class="markdown level1 summary"><p>Initializes a new instance of the object with ability to cancel locked tasks.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="decalaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public SchedulerLock(CancellationTokenSource cancellation = null, int maxItemsPerTask = 5)</code></pre>
  </div>
  <h5 class="parameters">Parameters</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">CancellationTokenSource</span></td>
        <td><span class="parametername">cancellation</span></td>
        <td><p>Cancellation source to allow cancel the tasks run by the schedulers.</p>
</td>
      </tr>
      <tr>
        <td><span class="xref">System.Int32</span></td>
        <td><span class="parametername">maxItemsPerTask</span></td>
        <td><p>Number of exclusive tasks to process before checking concurrent tasks.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h3 id="methods">Methods
  </h3>
  <span class="small pull-right mobile-hide">
    <span class="divider">|</span>
    <a href="https://github.com/CityChainFoundation/city-chain/new/master/docs-ref-overwrite/new?filename=Stratis_Bitcoin_Utilities_SchedulerLock_ReadAsync_Action_.md&amp;value=---%0Auid%3A%20Stratis.Bitcoin.Utilities.SchedulerLock.ReadAsync(Action)%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">Improve this Doc</a>
  </span>
  <span class="small pull-right mobile-hide">
    <a href="https://github.com/CityChainFoundation/city-chain/blob/master/src/Stratis.Bitcoin/Utilities/SchedulerLock.cs/#L99">View Source</a>
  </span>
  <a id="Stratis_Bitcoin_Utilities_SchedulerLock_ReadAsync_" data-uid="Stratis.Bitcoin.Utilities.SchedulerLock.ReadAsync*"></a>
  <h4 id="Stratis_Bitcoin_Utilities_SchedulerLock_ReadAsync_Action_" data-uid="Stratis.Bitcoin.Utilities.SchedulerLock.ReadAsync(Action)">ReadAsync(Action)</h4>
  <div class="markdown level1 summary"><p>Queues concurrent work to the concurrent scheduler.
Delegates calling this method will be done in parallel on the default scheduler.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="decalaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public Task ReadAsync(Action func)</code></pre>
  </div>
  <h5 class="parameters">Parameters</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">Action</span></td>
        <td><span class="parametername">func</span></td>
        <td><p>Method to be called with locked reader lock.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h5 class="returns">Returns</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">Task</span></td>
        <td></td>
      </tr>
    </tbody>
  </table>
  <span class="small pull-right mobile-hide">
    <span class="divider">|</span>
    <a href="https://github.com/CityChainFoundation/city-chain/new/master/docs-ref-overwrite/new?filename=Stratis_Bitcoin_Utilities_SchedulerLock_ReadAsync__1_Func___0__.md&amp;value=---%0Auid%3A%20Stratis.Bitcoin.Utilities.SchedulerLock.ReadAsync%60%601(Func%7B%60%600%7D)%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">Improve this Doc</a>
  </span>
  <span class="small pull-right mobile-hide">
    <a href="https://github.com/CityChainFoundation/city-chain/blob/master/src/Stratis.Bitcoin/Utilities/SchedulerLock.cs/#L106">View Source</a>
  </span>
  <a id="Stratis_Bitcoin_Utilities_SchedulerLock_ReadAsync_" data-uid="Stratis.Bitcoin.Utilities.SchedulerLock.ReadAsync*"></a>
  <h4 id="Stratis_Bitcoin_Utilities_SchedulerLock_ReadAsync__1_Func___0__" data-uid="Stratis.Bitcoin.Utilities.SchedulerLock.ReadAsync``1(Func{``0})">ReadAsync&lt;T&gt;(Func&lt;T&gt;)</h4>
  <div class="markdown level1 summary"><p>Queues concurrent work to the concurrent scheduler.
Delegates calling this method will be done in parallel on the default scheduler.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="decalaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public Task&lt;T&gt; ReadAsync&lt;T&gt;(Func&lt;T&gt; func)</code></pre>
  </div>
  <h5 class="parameters">Parameters</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">Func</span>&lt;T&gt;</td>
        <td><span class="parametername">func</span></td>
        <td><p>Method to be called with locked reader lock.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h5 class="returns">Returns</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">Task</span>&lt;T&gt;</td>
        <td><p>Return value of the delegated method.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h5 class="typeParameters">Type Parameters</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="parametername">T</span></td>
        <td><p>Return type of the delegated method.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h5 id="Stratis_Bitcoin_Utilities_SchedulerLock_ReadAsync__1_Func___0___remarks">Remarks</h5>
  <div class="markdown level1 remarks"><p>See warning in <a class="xref" href="Stratis.Bitcoin.Utilities.SchedulerLock.html">SchedulerLock</a> remarks section.</p>
</div>
  <span class="small pull-right mobile-hide">
    <span class="divider">|</span>
    <a href="https://github.com/CityChainFoundation/city-chain/new/master/docs-ref-overwrite/new?filename=Stratis_Bitcoin_Utilities_SchedulerLock_WriteAsync_Action_.md&amp;value=---%0Auid%3A%20Stratis.Bitcoin.Utilities.SchedulerLock.WriteAsync(Action)%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">Improve this Doc</a>
  </span>
  <span class="small pull-right mobile-hide">
    <a href="https://github.com/CityChainFoundation/city-chain/blob/master/src/Stratis.Bitcoin/Utilities/SchedulerLock.cs/#L113">View Source</a>
  </span>
  <a id="Stratis_Bitcoin_Utilities_SchedulerLock_WriteAsync_" data-uid="Stratis.Bitcoin.Utilities.SchedulerLock.WriteAsync*"></a>
  <h4 id="Stratis_Bitcoin_Utilities_SchedulerLock_WriteAsync_Action_" data-uid="Stratis.Bitcoin.Utilities.SchedulerLock.WriteAsync(Action)">WriteAsync(Action)</h4>
  <div class="markdown level1 summary"><p>Queues sequential work to the exclusive scheduler.
Delegates calling this method will be done in sequentially,
The first task will be queued on the default scheduler subsequent exclusive tasks will run in that same thread.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="decalaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public Task WriteAsync(Action func)</code></pre>
  </div>
  <h5 class="parameters">Parameters</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">Action</span></td>
        <td><span class="parametername">func</span></td>
        <td><p>Method to be called with locked writer lock.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h5 class="returns">Returns</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">Task</span></td>
        <td></td>
      </tr>
    </tbody>
  </table>
  <h5 id="Stratis_Bitcoin_Utilities_SchedulerLock_WriteAsync_Action__remarks">Remarks</h5>
  <div class="markdown level1 remarks"><p>See warning in <a class="xref" href="Stratis.Bitcoin.Utilities.SchedulerLock.html">SchedulerLock</a> remarks section.</p>
</div>
  <span class="small pull-right mobile-hide">
    <span class="divider">|</span>
    <a href="https://github.com/CityChainFoundation/city-chain/new/master/docs-ref-overwrite/new?filename=Stratis_Bitcoin_Utilities_SchedulerLock_WriteAsync__1_Func___0__.md&amp;value=---%0Auid%3A%20Stratis.Bitcoin.Utilities.SchedulerLock.WriteAsync%60%601(Func%7B%60%600%7D)%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">Improve this Doc</a>
  </span>
  <span class="small pull-right mobile-hide">
    <a href="https://github.com/CityChainFoundation/city-chain/blob/master/src/Stratis.Bitcoin/Utilities/SchedulerLock.cs/#L120">View Source</a>
  </span>
  <a id="Stratis_Bitcoin_Utilities_SchedulerLock_WriteAsync_" data-uid="Stratis.Bitcoin.Utilities.SchedulerLock.WriteAsync*"></a>
  <h4 id="Stratis_Bitcoin_Utilities_SchedulerLock_WriteAsync__1_Func___0__" data-uid="Stratis.Bitcoin.Utilities.SchedulerLock.WriteAsync``1(Func{``0})">WriteAsync&lt;T&gt;(Func&lt;T&gt;)</h4>
  <div class="markdown level1 summary"><p>Queues sequential work to the exclusive scheduler.
Delegates calling this method will be done in sequentially,
The first task will be queued on the default scheduler subsequent exclusive tasks will run in that same thread.</p>
</div>
  <div class="markdown level1 conceptual"></div>
  <h5 class="decalaration">Declaration</h5>
  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public Task&lt;T&gt; WriteAsync&lt;T&gt;(Func&lt;T&gt; func)</code></pre>
  </div>
  <h5 class="parameters">Parameters</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">Func</span>&lt;T&gt;</td>
        <td><span class="parametername">func</span></td>
        <td><p>Method to be called with locked writer lock.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h5 class="returns">Returns</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="xref">Task</span>&lt;T&gt;</td>
        <td><p>Return value of the delegated method.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h5 class="typeParameters">Type Parameters</h5>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><span class="parametername">T</span></td>
        <td><p>Return type of the delegated method.</p>
</td>
      </tr>
    </tbody>
  </table>
  <h5 id="Stratis_Bitcoin_Utilities_SchedulerLock_WriteAsync__1_Func___0___remarks">Remarks</h5>
  <div class="markdown level1 remarks"><p>See warning in <a class="xref" href="Stratis.Bitcoin.Utilities.SchedulerLock.html">SchedulerLock</a> remarks section.</p>
</div>
  <h3 id="implements">Implements</h3>
  <div>
      <a class="xref" href="Stratis.Bitcoin.Utilities.ISchedulerLock.html">ISchedulerLock</a>
  </div>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/CityChainFoundation/city-chain/new/master/docs-ref-overwrite/new?filename=Stratis_Bitcoin_Utilities_SchedulerLock.md&amp;value=---%0Auid%3A%20Stratis.Bitcoin.Utilities.SchedulerLock%0Asummary%3A%20'*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax'%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A" class="contribution-link">Improve this Doc</a>
                  </li>
                  <li>
                    <a href="https://github.com/CityChainFoundation/city-chain/blob/master/src/Stratis.Bitcoin/Utilities/SchedulerLock.cs/#L73" class="contribution-link">View Source</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <a href='https://www.city-chain.org'>city-chain.org</a> | <a href='https://www.citychain.foundation'>citychain.foundation</a>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
