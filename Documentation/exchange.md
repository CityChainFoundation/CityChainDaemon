# Exchange

If you are running an exchange and want to support City Coin, these are the instructions to follow.

## Operating System

Depending on your operating system, you need to run different procedures. We have provided easy to use shell scripts that automate most of the setup process.

## Binary Release vs Source Code vs Docker

We advice exchanges to rely on the official releases, and not use self-built nodes based on the master source code. The master branch is not guaranteed to be 
stable or fully tested, and not guaranteed to be fully compatible with the main network.

The easiest way to get started, is to rely on the RPC docker-compose template, which is available here:

https://github.com/CityChainFoundation/city-chain/blob/master/Docker/City.Chain/RPC/docker-compose.yml

You should modify the settings according to your needs, especially the walletnotify URL.

## Scripts

Installation scripts is available in the [Scripts](Scripts) folder. The one that exchanges should normally rely on, it the "install_city_binaries.sh".

## Configuration

The default configuration file that is written by the installation script, is not enough to get a fully working exchange node. You need to update the city.conf
with the following configuration:


```
# Expose the node as an RPC Server.
server=1
txindex=1
apiuri=http://0.0.0.0:4335
rpcport=4334

# Release 16
rpcallowip=0.0.0.0

# Release 17
rpcallowip=127.0.0.1

# Notify URL when transactions are received.
walletnotify=curl -X POST -d txid=%s http://localhost/api

# These are auto-generated by installation script.
rpcuser=rpcuser
rpcpassword=rpcpassword

# Create a default wallet on initial startup.

# Release 16
defaultwallet=1
defaultwalletpassword=default

# Release 17
defaultwalletname=default
unlockdefaultwallet=1

# Add a few known nodes to more quickly start initial blockchain download (IBD).
addnode=52.175.194.227
addnode=13.66.158.6
```


## Step by Step Guide

### 1. Ubuntu

To install City Chain Node on Ubuntu - as <code>sudo su root</code> run the following command:

<code> bash <( curl -L http://bit.ly/citychain-install ) </code>

### 2. Modify city.conf

Modify the city.conf file with the values specified above.

Normal file location: /home/city/.citychain/city/CityMain/city.conf

### 3. Stop and start the daemon

```
sudo service cityd@city stop
sudo service cityd@city start
```

## RPC API notes

The City Chain daemon uses a HD-wallet and the RPC method "getnewaddress" will return the next unused address. This means the exchange integration cannot 
rely on this RPC call to get new addresses for new users/customers.

Instead the REST API must be used, example that generates 1000 addresses:

http://localhost:4335/api/Wallet/unusedaddresses?WalletName=default&AccountName=account%200&Count=1000&api-version=1.0

These addresses can then be stored in a database and be given to new users/customers.
